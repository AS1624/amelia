<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add outfit</title>
    <link rel="stylesheet" href="header.css">
    <link rel="stylesheet" href="body.css">
    <link rel="stylesheet" href="add.css">
</head>
<body>
    <header>
        <div id="top">
            <span id="search-container">new outfit</span>
            <button id="upload-button" class="disabled">Upload</button>
        </div>
    </header>
    <div id="content">
        <div id="text-input-container" >
            <input type="text" id="name" class="form-input" placeholder="outfit name">
            <textarea
                    id="description"
                    class="form-input"
                    placeholder="clothes included: top, bottom, etc."
                    rows="4"
            >
            </textarea>
            <input type="text" id="tags" class="form-input" placeholder="tags">
        </div>
        <div id="image-input-container">
            <label id="image-input-label" for="image-input">Add Image</label>
            <input type="file" id="image-input" accept="image/*">
        </div>
        <p id="response"></p>
        <script src="enumerate.js"></script>

        <script>
            let file = null
            showInput()
            document.getElementById("content").addEventListener("input", updateInputStatus)
            function showImage() {
                let input = document.getElementById("image-input");
                document.getElementById("image-input-container").innerHTML = (
                    "<img src=\""
                    + window.URL.createObjectURL(
                        input.files[0]
                    )
                    + "\" id=\"image-display\">"
                    + "\n <button id=\"remove\"> X </button>"
                );
                document.getElementById("remove").addEventListener("click", () => {
                    showInput()
                    updateInputStatus()
                })
                document.getElementById("image-input-container").className = "has-image"
            }
            function showInput() {
                document.getElementById("image-input-container").innerHTML = (
                    `<label id="image-input-label" for="image-input">Add Image</label>`
                    + `<input type="file" id="image-input" accept="image/*">`
                )
                document.getElementById("image-input").addEventListener("input", () => {
                    updateInputStatus()
                    showImage()
                })
                document.getElementById("image-input-container").className = "has-upload"
            }
            function updateInputStatus(event) {
                let uploadButton = document.getElementById("upload-button");
                console.log("upload status changed");
                console.log(document.getElementById("image-input").files[0])
                file = document.getElementById("image-input").files[0]
                if (document.getElementById("name").value === ""
                    || document.getElementById("description").value === ""
                    || document.getElementById("tags").value === ""
                    || document.getElementById("image-input").files.length === 0
                ) {
                    uploadButton.className = "disabled"
                } else {
                    uploadButton.className = "enabled"
                }
            }
        </script>
        <script src="upload.js"></script>
        <script>
            let button = document.getElementById('upload-button');
            button.addEventListener('click', async () => {
                if(button.className === "enabled" && file) {
                    await sendToBackend(
                        document.getElementById('name').value,
                        document.getElementById('description').value,
                        document.getElementById('tags').value,
                        file
                    );
                }
            });
        </script>
    </div>
</body>
</html>
